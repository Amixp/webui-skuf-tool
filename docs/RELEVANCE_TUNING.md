# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

## –ß—Ç–æ —Ç–∞–∫–æ–µ SIMILARITY_THRESHOLD?

`SIMILARITY_THRESHOLD` - —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ (score) –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –≤–µ–∫—Ç–æ—Ä–Ω—ã–º –ø–æ–∏—Å–∫–æ–º. –î–æ–∫—É–º–µ–Ω—Ç—ã —Å score –Ω–∏–∂–µ —ç—Ç–æ–≥–æ –ø–æ—Ä–æ–≥–∞ –±—É–¥—É—Ç –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã.

**Score (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å)** –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞–∫ `1 - (embedding <=> query_embedding)`, –≥–¥–µ:
- `<=>` - –æ–ø–µ—Ä–∞—Ç–æ—Ä –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –≤ pgvector
- –ó–Ω–∞—á–µ–Ω–∏—è –æ—Ç 0.0 –¥–æ 1.0 (—á–µ–º –≤—ã—à–µ, —Ç–µ–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–µ–µ)
- 1.0 = –∏–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, 0.0 = –ø–æ–ª–Ω–æ–µ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ

## –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥?

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É

```bash
python3 scripts/diagnose_rag.py
```

–°–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç:
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ score –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø–æ—Ä–æ–≥–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä–æ–≥–∞—Ö

### –®–∞–≥ 2: –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

```
üìä –ê–Ω–∞–ª–∏–∑ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏:
   –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π score: 0.4200
   –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π score: 0.8500
   –°—Ä–µ–¥–Ω–∏–π score: 0.6200
   –ú–µ–¥–∏–∞–Ω–Ω—ã–π score: 0.5800

üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä–æ–≥–æ–≤ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏:
   –ü–æ—Ä–æ–≥ 0.0: 10 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   –ü–æ—Ä–æ–≥ 0.3: 10 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   –ü–æ—Ä–æ–≥ 0.4: 8 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   –ü–æ—Ä–æ–≥ 0.5: 5 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   –ü–æ—Ä–æ–≥ 0.6: 3 –¥–æ–∫—É–º–µ–Ω—Ç–∞
   –ü–æ—Ä–æ–≥ 0.7: 1 –¥–æ–∫—É–º–µ–Ω—Ç
```

### –®–∞–≥ 3: –í—ã–±–æ—Ä –ø–æ—Ä–æ–≥–∞

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–∏–∑–∫–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å (max score < 0.5)

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–º–µ—é—Ç –Ω–∏–∑–∫—É—é —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –í .env —Ñ–∞–π–ª–µ
SIMILARITY_THRESHOLD=0.0
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:** –ü—Ä–∏ –Ω–∏–∑–∫–æ–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –ª—É—á—à–µ –≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –ø–æ–∑–≤–æ–ª–∏—Ç—å –º–æ–¥–µ–ª–∏ —Å–∞–º–æ–π –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°—Ä–µ–¥–Ω—è—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å (max score 0.5-0.7)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, –Ω–æ –º–Ω–æ–≥–æ —à—É–º–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–¥–∏–∞–Ω–Ω—ã–π –∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π score –∏–∑ —Ç–æ–ø-5
SIMILARITY_THRESHOLD=0.4
```

**–ü—Ä–∏–º–µ—Ä:**
- –ï—Å–ª–∏ —Ç–æ–ø-5 –∏–º–µ—é—Ç score: [0.65, 0.58, 0.52, 0.45, 0.42]
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `SIMILARITY_THRESHOLD=0.42` —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–æ–ø-5
- –ò–ª–∏ `SIMILARITY_THRESHOLD=0.5` –¥–ª—è –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –í—ã—Å–æ–∫–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å (max score > 0.7)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –Ω—É–∂–Ω–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Å–ª–∞–±—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –°—Ç—Ä–æ–≥–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
SIMILARITY_THRESHOLD=0.6
# –∏–ª–∏
SIMILARITY_THRESHOLD=0.7
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ (SKUF)

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –ë–æ–ª—å—à–æ–π –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö (800K+ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
- –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
```bash
SIMILARITY_THRESHOLD=0.4
CONTEXT_LIMIT=5
```

**–ü–æ—á–µ–º—É:**
- –ü–æ—Ä–æ–≥ 0.4 –æ—Ç—Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —è–≤–Ω–æ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- 5 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–¥–µ–ª–∏ –≤—ã–±—Ä–∞—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ

### –ü—Ä–∏–º–µ—Ä 2: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- –ß–µ—Ç–∫–∏–µ —Ç–µ–º—ã
- –ù—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
```bash
SIMILARITY_THRESHOLD=0.5
CONTEXT_LIMIT=3
```

**–ü–æ—á–µ–º—É:**
- –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–π –ø–æ—Ä–æ–≥ –¥–ª—è —Ç–æ—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- –ú–µ–Ω—å—à–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ = –±–æ–ª–µ–µ —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

### –ü—Ä–∏–º–µ—Ä 3: –û–±—â–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
- –ù—É–∂–Ω–∞ —à–∏—Ä–æ—Ç–∞ –æ—Ö–≤–∞—Ç–∞
- –î–æ–ø—É—Å—Ç–∏–º—ã –º–µ–Ω–µ–µ —Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
```bash
SIMILARITY_THRESHOLD=0.3
CONTEXT_LIMIT=7
```

**–ü–æ—á–µ–º—É:**
- –ù–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥ –¥–ª—è —à–∏—Ä–æ–∫–æ–≥–æ –æ—Ö–≤–∞—Ç–∞
- –ë–æ–ª—å—à–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

## –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ API

–í—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `context_limit` –∏ `similarity_threshold` –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ:

### –ü—Ä–∏–º–µ—Ä 1: –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ env)

```bash
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "–ö–∞–∫–∏–µ —Ç–∏–ø—ã –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –µ—Å—Ç—å?",
    "model_name": "qwen3:8b",
    "context_limit": 5
  }'
```

### –ü—Ä–∏–º–µ—Ä 2: –° —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–æ—Ä–æ–≥–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏

```bash
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "–ö–∞–∫–∏–µ —Ç–∏–ø—ã –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –µ—Å—Ç—å?",
    "model_name": "qwen3:8b",
    "context_limit": 5,
    "similarity_threshold": 0.5
  }'
```

### –ü—Ä–∏–º–µ—Ä 3: –°—Ç—Ä–æ–≥–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–≤—ã—Å–æ–∫–∏–π –ø–æ—Ä–æ–≥)

```bash
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "–ö–∞–∫ —Ä–µ—à–∞–ª–∏—Å—å –ø—Ä–æ–±–ª–µ–º—ã —Å Elasticsearch?",
    "model_name": "qwen3:8b",
    "context_limit": 3,
    "similarity_threshold": 0.7
  }'
```

### –ü—Ä–∏–º–µ—Ä 4: –ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (–Ω–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥)

```bash
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ",
    "model_name": "qwen3:8b",
    "context_limit": 10,
    "similarity_threshold": 0.0
  }'
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä               | –¢–∏–ø     | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é                  | –û–ø–∏—Å–∞–Ω–∏–µ                                  |
| ---------------------- | ------- | ------------ | ----------------------------- | ----------------------------------------- |
| `message`              | string  | –î–∞           | -                             | –¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞                             |
| `model_name`           | string  | –ù–µ—Ç          | `qwen3:8b`                    | –ò–º—è –º–æ–¥–µ–ª–∏ Ollama                         |
| `context_limit`        | integer | –ù–µ—Ç          | `5`                           | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤        |
| `similarity_threshold` | float   | –ù–µ—Ç          | –ò–∑ `SIMILARITY_THRESHOLD` env | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ (0.0-1.0) |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ï—Å–ª–∏ `similarity_threshold` –Ω–µ —É–∫–∞–∑–∞–Ω –≤ –∑–∞–ø—Ä–æ—Å–µ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `SIMILARITY_THRESHOLD`.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### 1. –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤

–°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:
```bash
docker logs rag-chat-app | grep "–ù–∞–π–¥–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤"
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä–æ–≥–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:

```python
import requests

test_queries = [
    "–ö–∞–∫–∏–µ —Ç–∏–ø—ã –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –µ—Å—Ç—å?",
    "–ö–∞–∫ —Ä–µ—à–∞–ª–∏—Å—å –ø—Ä–æ–±–ª–µ–º—ã —Å Elasticsearch?",
    "–ö–∞–∫–∏–µ —Å–µ—Ä–≤–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å?"
]

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–æ—Ä–æ–≥–∞–º–∏
thresholds = [0.0, 0.3, 0.5, 0.7]

for threshold in thresholds:
    print(f"\n{'='*60}")
    print(f"–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–æ—Ä–æ–≥–æ–º: {threshold}")
    print(f"{'='*60}")

    for query in test_queries:
        response = requests.post(
            "http://localhost:8000/chat",
            json={
                "message": query,
                "model_name": "qwen3:8b",
                "context_limit": 5,
                "similarity_threshold": threshold  # –ü–µ—Ä–µ–¥–∞–µ–º –ø–æ—Ä–æ–≥ –≤ –∑–∞–ø—Ä–æ—Å–µ
            }
        )
        data = response.json()
        docs_count = len(data.get("context_used", []))
        print(f"\n–ó–∞–ø—Ä–æ—Å: {query}")
        print(f"–ù–∞–π–¥–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: {docs_count}")
        if docs_count > 0:
            scores = [doc.get("score", 0) for doc in data["context_used"]]
            print(f"Score: {[f'{s:.4f}' for s in scores]}")
            print(f"Min score: {min(scores):.4f}, Max score: {max(scores):.4f}")
        else:
            print("‚ö†Ô∏è  –î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã (–ø–æ—Ä–æ–≥ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π)")
```

### 3. –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

1. –ù–∞—á–Ω–∏—Ç–µ —Å `SIMILARITY_THRESHOLD=0.0` (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏)
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
3. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ score –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–æ—Ä–æ–≥ –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ score –∏–∑ —Ö–æ—Ä–æ—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
5. –ü–æ–≤—Ç–æ—Ä—è–π—Ç–µ –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞

## –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–∞—Ö–æ–¥–∏—Ç—Å—è 0 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ü–æ—Ä–æ–≥ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π
2. –ù–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏
3. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –í—Ä–µ–º–µ–Ω–Ω–æ —Å–Ω–∏–∑—å—Ç–µ –ø–æ—Ä–æ–≥
SIMILARITY_THRESHOLD=0.0

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π
python3 scripts/diagnose_rag.py
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ü–æ—Ä–æ–≥ —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π
2. –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
3. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–≤–µ–ª–∏—á—å—Ç–µ –ø–æ—Ä–æ–≥
SIMILARITY_THRESHOLD=0.5

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
python3 scripts/diagnose_rag.py
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–∏–∑–∫–∏–µ score (–≤—Å–µ < 0.5)

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–æ–¥–µ–ª–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ –¥–∞–Ω–Ω—ã—Ö
2. –ü–ª–æ—Ö–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
2. –ü–µ—Ä–µ-–≤–µ–∫—Ç–æ—Ä–∏–∑—É–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å –¥—Ä—É–≥–æ–π –º–æ–¥–µ–ª—å—é
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `SIMILARITY_THRESHOLD=0.0` –≤—Ä–µ–º–µ–Ω–Ω–æ

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —Ç–∏–ø–∞–º –¥–∞–Ω–Ω—ã—Ö

| –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö               | SIMILARITY_THRESHOLD | CONTEXT_LIMIT | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ              |
| ------------------------ | -------------------- | ------------- | ------------------------ |
| –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã/–¢–∏–∫–µ—Ç—ã         | 0.4-0.5              | 5-7           | –ë–∞–ª–∞–Ω—Å —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –æ—Ö–≤–∞—Ç–∞ |
| –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | 0.5-0.6              | 3-5           | –í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–∞   |
| FAQ                      | 0.5-0.7              | 3-5           | –ù—É–∂–Ω—ã —Ç–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã      |
| –û–±—â–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π        | 0.3-0.4              | 7-10          | –®–∏—Ä–æ–∫–∏–π –æ—Ö–≤–∞—Ç            |
| –ù–æ–≤–æ—Å—Ç–∏/–°—Ç–∞—Ç—å–∏           | 0.4-0.5              | 5-7           | –ë–∞–ª–∞–Ω—Å                   |

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç:
- –¢–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö
- –ö–∞—á–µ—Å—Ç–≤–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ —Ç–æ—á–Ω–æ—Å—Ç–∏
- –û–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

**–ù–∞—á–Ω–∏—Ç–µ —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, –∑–∞—Ç–µ–º –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ –ø–æ—Ä–æ–≥ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.**
